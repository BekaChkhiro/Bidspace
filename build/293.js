"use strict";(self.webpackChunkbrads_boilerplate_theme=self.webpackChunkbrads_boilerplate_theme||[]).push([[293],{7891:(e,t,r)=>{r.d(t,{j:()=>l});var o=r(223),n=r(3075),a=r(4057);const s=(0,o.Wp)({apiKey:"AIzaSyCOp6Z8ws4e6XSk1CTyVPqdDkAoe7Slldc",authDomain:"bidspace-86337.firebaseapp.com",projectId:"bidspace-86337",storageBucket:"bidspace-86337.firebasestorage.app",messagingSenderId:"242580753474",appId:"1:242580753474:web:d158b2b472c5cd74b931db",measurementId:"G-G2TT39HFNP"}),l=((0,n.P5)(s),(0,a.xI)(s));l.languageCode="ka",l.settings.appVerificationDisabledForTesting=!1},8761:(e,t,r)=>{r.d(t,{A:()=>s});var o=r(1609),n=r(7891),a=r(4057);const s=({onVerifierCreated:e})=>{(0,o.useRef)(null);const t=(0,o.useRef)(null);return(0,o.useEffect)((()=>((async()=>{try{if(console.log("Starting reCAPTCHA initialization..."),console.log("Current URL:",window.location.href),console.log("Domain:",window.location.hostname),t.current){try{await t.current.clear(),console.log("Cleared existing reCAPTCHA")}catch(e){console.error("Error clearing existing reCAPTCHA:",e)}t.current=null}if(!document.getElementById("recaptcha-container"))throw console.error("reCAPTCHA container not found"),new Error("reCAPTCHA container not found");console.log("Found reCAPTCHA container"),console.log("Creating new reCAPTCHA verifier...");const r=new a.kT(n.j,"recaptcha-container",{size:"normal",callback:e=>{console.log("reCAPTCHA verified successfully"),console.log("Response token:",e)},"expired-callback":()=>{console.log("reCAPTCHA expired"),t.current&&(t.current.clear(),t.current=null)},"error-callback":e=>{console.error("reCAPTCHA error:",e)}});t.current=r,console.log("reCAPTCHA verifier created successfully"),console.log("Attempting to render reCAPTCHA...");try{await r.render(),console.log("reCAPTCHA rendered successfully")}catch(e){throw console.error("Error rendering reCAPTCHA:",e),e}e(r)}catch(e){throw console.error("Error initializing reCAPTCHA:",{name:e.name,message:e.message,stack:e.stack,code:e.code}),e}})().catch((e=>{console.error("Failed to initialize reCAPTCHA:",e)})),()=>{if(t.current){try{t.current.clear(),console.log("Cleared reCAPTCHA on unmount")}catch(e){console.error("Error clearing reCAPTCHA on unmount:",e)}t.current=null}})),[e]),(0,o.createElement)("div",{id:"recaptcha-container",style:{display:"flex",justifyContent:"center",margin:"10px 0"}})}},4860:(e,t,r)=>{r.d(t,{A:()=>n});var o=r(1609);const n=({message:e,type:t,onClose:r})=>{const n="success"===t?"bg-green-50":"error"===t?"bg-red-50":"bg-blue-50",a="success"===t?"text-green-800":"error"===t?"text-red-800":"text-blue-800",s="success"===t?"border-green-400":"error"===t?"border-red-400":"border-blue-400",l="success"===t?"text-green-400":"error"===t?"text-red-400":"text-blue-400";return(0,o.createElement)("div",{className:`rounded-md ${n} p-4 mb-4 border ${s}`},(0,o.createElement)("div",{className:"flex"},(0,o.createElement)("div",{className:"flex-shrink-0"},"success"===t?(0,o.createElement)("svg",{className:`h-5 w-5 ${l}`,viewBox:"0 0 20 20",fill:"currentColor"},(0,o.createElement)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):"error"===t?(0,o.createElement)("svg",{className:`h-5 w-5 ${l}`,viewBox:"0 0 20 20",fill:"currentColor"},(0,o.createElement)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})):(0,o.createElement)("svg",{className:`h-5 w-5 ${l}`,viewBox:"0 0 20 20",fill:"currentColor"},(0,o.createElement)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"}))),(0,o.createElement)("div",{className:"ml-3 flex-1"},(0,o.createElement)("p",{className:`text-sm ${a}`},e)),r&&(0,o.createElement)("div",{className:"ml-auto pl-3"},(0,o.createElement)("div",{className:"-mx-1.5 -my-1.5"},(0,o.createElement)("button",{type:"button",onClick:r,className:`inline-flex rounded-md p-1.5 ${a} hover:${n} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-${"success"===t?"green":"error"===t?"red":"blue"}-50 focus:ring-${"success"===t?"green":"error"===t?"red":"blue"}-600`},(0,o.createElement)("span",{className:"sr-only"},"Dismiss"),(0,o.createElement)("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},(0,o.createElement)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})))))))}},2293:(e,t,r)=>{r.r(t),r.d(t,{default:()=>c});var o=r(1609),n=r(4740),a=r(4860),s=r(8924),l=r(438),i=r(4674);const c=()=>{const{user:e}=(0,n.A)(),[t,r]=(0,o.useState)({first_name:"",last_name:"",email:"",phone_number:"",nickname:"",piradi_nomeri:""}),[c,d]=(0,o.useState)(!1),[m,u]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!1),[p,b]=(0,o.useState)(null);(0,o.useEffect)((()=>{e&&h()}),[e]);const h=async()=>{try{const e=await fetch("/wp-json/wp/v2/users/me",{credentials:"include",headers:{"X-WP-Nonce":wpApiSettings.nonce}}),t=await e.json();r({first_name:t.first_name||"",last_name:t.last_name||"",email:t.email||"",phone_number:t.meta?.phone_number||"",nickname:t.nickname||"",piradi_nomeri:t.meta?.piradi_nomeri||""})}catch(e){console.error("Error fetching user data:",e)}},y=(e,t="success")=>{b({message:e,type:t}),setTimeout((()=>b(null)),3e3)},w=e=>{const{name:t,value:o}=e.target;r((e=>({...e,[t]:o})))};return(0,o.createElement)("div",{className:"w-full px-4 py-8"},(0,o.createElement)("div",{className:"flex flex-col gap-6 max-w-4xl mx-auto"},p&&(0,o.createElement)("div",{className:"fixed bottom-4 right-4 z-50"},(0,o.createElement)(a.A,{message:p.message,type:p.type,onClose:()=>b(null)})),(0,o.createElement)("h2",{className:"text-xl md:text-2xl font-bold"},"პირადი მონაცემების რედაქტირება"),(0,o.createElement)("form",{onSubmit:async e=>{e.preventDefault(),d(!0);try{if(!(await fetch("/wp-json/wp/v2/users/me",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({first_name:t.first_name,last_name:t.last_name,email:t.email,nickname:t.nickname,meta:{phone_number:t.phone_number,piradi_nomeri:t.piradi_nomeri}})})).ok)throw new Error("Update failed");y("პროფილი წარმატებით განახლდა")}catch(e){console.error("Error updating profile:",e),y("პროფილის განახლება ვერ მოხერხდა","error")}d(!1)},className:"space-y-4 md:space-y-6"},(0,o.createElement)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"first_name",className:"block text-sm font-medium text-gray-700"},"სახელი"),(0,o.createElement)("input",{type:"text",id:"first_name",name:"first_name",value:t.first_name,onChange:w,required:!0,className:"settings-field-style mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})),(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"last_name",className:"block text-sm font-medium text-gray-700"},"გვარი"),(0,o.createElement)("input",{type:"text",id:"last_name",name:"last_name",value:t.last_name,onChange:w,required:!0,className:"settings-field-style mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}))),(0,o.createElement)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700"},"ელ-ფოსტა"),(0,o.createElement)("div",{className:"mt-1 relative"},(0,o.createElement)("input",{type:"email",id:"email",name:"email",value:t.email,disabled:!0,className:"settings-field-style block w-full rounded-md border-gray-300 bg-gray-100 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 pr-20"}),(0,o.createElement)("button",{type:"button",onClick:()=>f(!0),className:"absolute right-2 top-1/2 -translate-y-1/2 px-4 py-1.5 text-sm text-white bg-black rounded-full hover:bg-gray-800 transition-colors"},"შეცვლა"))),(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"phone_number",className:"block text-sm font-medium text-gray-700"},"ტელეფონის ნომერი"),(0,o.createElement)("div",{className:"mt-1 relative"},(0,o.createElement)("input",{type:"text",id:"phone_number",name:"phone_number",value:t.phone_number,disabled:!0,className:"settings-field-style block w-full rounded-md border-gray-300 bg-gray-100 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 pr-20"}),(0,o.createElement)("button",{type:"button",onClick:()=>u(!0),className:"absolute right-2 top-1/2 -translate-y-1/2 px-4 py-1.5 text-sm text-white bg-black rounded-full hover:bg-gray-800 transition-colors"},"შეცვლა")))),(0,o.createElement)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"nickname",className:"block text-sm font-medium text-gray-700"},"მომხმარებლის სახელი"),(0,o.createElement)("input",{type:"text",id:"nickname",name:"nickname",value:t.nickname,onChange:w,required:!0,className:"settings-field-style mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})),(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"piradi_nomeri",className:"block text-sm font-medium text-gray-700"},"პირადი ნომერი"),(0,o.createElement)("input",{type:"text",id:"piradi_nomeri",name:"piradi_nomeri",value:t.piradi_nomeri,onChange:w,className:"settings-field-style mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}))),(0,o.createElement)("div",{className:"flex"},(0,o.createElement)("button",{type:"submit",className:"w-full md:w-auto px-6 py-3 bg-black text-white rounded-md hover:bg-gray-800",disabled:c},"შენახვა"))),(0,o.createElement)("div",{className:"border-t pt-6"},(0,o.createElement)(s.A,null)),(0,o.createElement)(l.A,{isOpen:m,onClose:()=>u(!1),currentPhone:t.phone_number,onPhoneChange:e=>{r((t=>({...t,phone_number:e}))),y("ტელეფონის ნომერი წარმატებით შეიცვალა")}}),(0,o.createElement)(i.A,{isOpen:g,onClose:()=>f(!1),currentEmail:t.email,onEmailChange:e=>{r((t=>({...t,email:e}))),y("ელ-ფოსტა წარმატებით შეიცვალა")}})))}},4674:(e,t,r)=>{r.d(t,{A:()=>s});var o=r(1609),n=(r(2389),r(4860));const a=({currentEmail:e,onEmailChange:t})=>{const[r,a]=(0,o.useState)(""),[s,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),[d,m]=(0,o.useState)(!1),[u,g]=(0,o.useState)("initial"),[f,p]=(0,o.useState)(null),[b,h]=(0,o.useState)(60),[y,w]=(0,o.useState)(null),v=(e,t)=>{p({message:e,type:t}),setTimeout((()=>p(null)),5e3)},x=()=>{h(60),y&&clearInterval(y);const e=setInterval((()=>{h((t=>t<=1?(clearInterval(e),g("initial"),v("დრო ამოიწურა. სცადეთ თავიდან","error"),0):t-1))}),1e3);w(e)},E=()=>{y&&clearInterval(y),g("initial"),l(""),c(""),a("")};return(0,o.createElement)("div",{className:"flex flex-col gap-4"},f&&(0,o.createElement)(n.A,{message:f.message,type:f.type,onClose:()=>p(null)}),"initial"===u&&(0,o.createElement)("div",{className:"flex flex-col gap-2.5"},(0,o.createElement)("p",{className:"text-sm text-gray-600"},"ელ-ფოსტის შესაცვლელად, ჯერ დაადასტურეთ თქვენი მიმდინარე ელ-ფოსტა (",e,")"),(0,o.createElement)("button",{type:"button",onClick:async()=>{m(!0);try{if(!(await fetch("/wp-json/bidspace/v1/request-email-verification",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce}})).ok)throw new Error("Failed to send verification code");g("verifyingCurrent"),v("დადასტურების კოდი გამოგზავნილია თქვენს მიმდინარე ელ-ფოსტაზე","success"),x()}catch(e){console.error("Error sending verification code:",e),v(e.message||"დადასტურების კოდის გაგზავნა ვერ მოხერხდა","error")}m(!1)},disabled:d,className:"w-full inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:bg-gray-400 transition-colors"},d?"იგზავნება...":"დადასტურების კოდის გაგზავნა")),"verifyingCurrent"===u&&(0,o.createElement)("div",{className:"flex flex-col gap-4"},(0,o.createElement)("div",{className:"flex flex-col gap-2.5"},(0,o.createElement)("label",{htmlFor:"current_verification_code",className:"text-sm font-medium text-gray-700"},"დადასტურების კოდი ",b>0&&(0,o.createElement)("span",{className:"text-gray-500 ml-2"},"(",b," წამი)")),(0,o.createElement)("input",{type:"text",id:"current_verification_code",value:s,onChange:e=>l(e.target.value),maxLength:6,placeholder:"შეიყვანეთ 6-ნიშნა კოდი",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})),(0,o.createElement)("div",{className:"flex gap-4"},(0,o.createElement)("button",{type:"button",onClick:E,className:"flex-1 py-2 px-4 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},"გაუქმება"),(0,o.createElement)("button",{type:"button",onClick:async()=>{if(s){m(!0);try{if(!(await fetch("/wp-json/bidspace/v1/verify-current-email",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({code:s})})).ok)throw new Error("Invalid code");y&&clearInterval(y),g("enterNew"),l(""),v("მიმდინარე ელ-ფოსტა დადასტურებულია","success")}catch(e){console.error("Error verifying code:",e),v("არასწორი კოდი","error")}m(!1)}else v("გთხოვთ შეიყვანოთ დადასტურების კოდი","error")},disabled:d||!s,className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:bg-gray-400 transition-colors"},"დადასტურება"))),"enterNew"===u&&(0,o.createElement)("div",{className:"flex flex-col gap-2.5"},(0,o.createElement)("label",{htmlFor:"new_email",className:"text-sm font-medium text-gray-700"},"ახალი ელ-ფოსტა"),(0,o.createElement)("input",{type:"email",id:"new_email",value:r,onChange:e=>a(e.target.value),placeholder:"example@mail.com",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"}),(0,o.createElement)("div",{className:"flex gap-4"},(0,o.createElement)("button",{type:"button",onClick:E,className:"flex-1 py-2 px-4 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},"გაუქმება"),(0,o.createElement)("button",{type:"button",onClick:async()=>{if(r){m(!0);try{if(!(await fetch("/wp-json/bidspace/v1/request-new-email-verification",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({new_email:r})})).ok)throw new Error("Failed to send verification code");g("verifyingNew"),v("დადასტურების კოდი გამოგზავნილია ახალ ელ-ფოსტაზე","success"),x()}catch(e){console.error("Error sending verification code:",e),v(e.message||"დადასტურების კოდის გაგზავნა ვერ მოხერხდა","error")}m(!1)}else v("გთხოვთ შეიყვანოთ ახალი ელ-ფოსტის მისამართი","error")},disabled:d||!r,className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:bg-gray-400 transition-colors"},"გაგრძელება"))),"verifyingNew"===u&&(0,o.createElement)("div",{className:"flex flex-col gap-4"},(0,o.createElement)("div",{className:"flex flex-col gap-2.5"},(0,o.createElement)("label",{htmlFor:"new_verification_code",className:"text-sm font-medium text-gray-700"},"დადასტურების კოდი ",b>0&&(0,o.createElement)("span",{className:"text-gray-500 ml-2"},"(",b," წამი)")),(0,o.createElement)("input",{type:"text",id:"new_verification_code",value:i,onChange:e=>c(e.target.value),maxLength:6,placeholder:"შეიყვანეთ 6-ნიშნა კოდი",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})),(0,o.createElement)("div",{className:"flex gap-4"},(0,o.createElement)("button",{type:"button",onClick:E,className:"flex-1 py-2 px-4 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},"გაუქმება"),(0,o.createElement)("button",{type:"button",onClick:async()=>{if(i){m(!0);try{if(!(await fetch("/wp-json/bidspace/v1/verify-new-email",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({code:i,new_email:r})})).ok)throw new Error("Invalid code");v("ელ-ფოსტა წარმატებით შეიცვალა","success"),t(r),y&&clearInterval(y),g("initial"),c(""),a("")}catch(e){console.error("Error verifying code:",e),v("არასწორი კოდი","error")}m(!1)}else v("გთხოვთ შეიყვანოთ დადასტურების კოდი","error")},disabled:d||!i,className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:bg-gray-400 transition-colors"},"დადასტურება"))))},s=({isOpen:e,onClose:t,currentEmail:r,onEmailChange:n})=>e?(0,o.createElement)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},(0,o.createElement)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},(0,o.createElement)("div",{className:"flex justify-between items-center mb-4"},(0,o.createElement)("h3",{className:"text-lg font-semibold"},"ელ-ფოსტის შეცვლა"),(0,o.createElement)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700"},(0,o.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},(0,o.createElement)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})))),(0,o.createElement)(a,{currentEmail:r,onEmailChange:e=>{n(e),t()}}))):null},8924:(e,t,r)=>{r.d(t,{A:()=>i});var o=r(1609),n=(r(2389),r(4860)),a=r(8761),s=r(7891),l=r(4057);const i=()=>{const[e,t]=(0,o.useState)({phone:"",verificationMethod:"sms",currentPassword:"",newPassword:"",confirmPassword:""}),[r,i]=(0,o.useState)(!1),[c,d]=(0,o.useState)(!1),[m,u]=(0,o.useState)(""),[g,f]=(0,o.useState)(null),[p,b]=(0,o.useState)(60),[h,y]=(0,o.useState)(null),[w,v]=(0,o.useState)(null);(0,o.useEffect)((()=>()=>{h&&clearInterval(h)}),[h]);const x=(0,o.useCallback)((e=>{v(e)}),[]),E=(e,t)=>{f({message:e,type:t}),setTimeout((()=>f(null)),5e3)},N=e=>{const{name:r,value:o}=e.target;t((e=>({...e,[r]:o})))},C=e=>{const t=e.replace(/\D/g,""),r=t.startsWith("995")?t.slice(3):t;return/^5\d{8}$/.test(r)},k=async()=>{i(!0);try{if("email"===e.verificationMethod){if(!(await fetch("/wp-json/bidspace/v1/request-password-reset",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({verification_method:"email"})})).ok)throw new Error("Failed to send verification code")}else{if(!C(e.phone))throw new Error("გთხოვთ შეიყვანოთ ვალიდური ქართული მობილურის ნომერი (მაგ: 555123456)");if(!w)throw new Error("გთხოვთ დაელოდოთ reCAPTCHA-ს ინიციალიზაციას");const t=e.phone.startsWith("995")?`+${e.phone}`:`+995${e.phone}`;console.log("1. Formatting phone number:",t),console.log("2. Sending SMS...");const r=await(0,l.ik)(s.j,t,w);console.log("3. SMS sent successfully!"),window.confirmationResult=r}d(!0),E("დადასტურების კოდი გამოგზავნილია","success"),(()=>{b(300),h&&clearInterval(h);const e=setInterval((()=>{b((t=>t<=1?(clearInterval(e),d(!1),E("დრო ამოიწურა. სცადეთ თავიდან","error"),0):t-1))}),1e3);y(e)})()}catch(e){console.error("Error details:",{code:e.code,message:e.message,stack:e.stack});let t=e.message;switch(e.code){case"auth/invalid-phone-number":t="არასწორი ტელეფონის ნომერი";break;case"auth/too-many-requests":t="ძალიან ბევრი მცდელობა. გთხოვთ სცადოთ მოგვიანებით";break;case"auth/captcha-check-failed":t="Recaptcha შემოწმება ვერ მოხერხდა. გთხოვთ სცადოთ თავიდან";break;case"auth/network-request-failed":t="ინტერნეტთან კავშირის პრობლემა. გთხოვთ შეამოწმოთ კავშირი";break;default:e.message.includes("-39")&&(t="Recaptcha ინიციალიზაციის შეცდომა. გთხოვთ განაახლოთ გვერდი")}E(t,"error")}finally{i(!1)}};return(0,o.createElement)("div",{className:"flex flex-col gap-4"},!c&&(0,o.createElement)(a.A,{onVerifierCreated:x}),g&&(0,o.createElement)(n.A,{message:g.message,type:g.type,onClose:()=>f(null)}),c?(0,o.createElement)("div",{className:"flex flex-col gap-4"},(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"verification_code",className:"block text-sm font-medium text-gray-700"},"დადასტურების კოდი ",p>0&&(0,o.createElement)("span",{className:"text-gray-500 ml-2"},"(",Math.floor(p/60),":",String(p%60).padStart(2,"0"),")")),(0,o.createElement)("input",{type:"text",id:"verification_code",value:m,onChange:e=>{const t=e.target.value.replace(/\D/g,"");u(t.slice(0,6))},maxLength:6,placeholder:"შეიყვანეთ 6-ნიშნა კოდი",className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",pattern:"\\d*",inputMode:"numeric"}),p>0&&(0,o.createElement)("button",{type:"button",onClick:async()=>{r||(h&&(clearInterval(h),y(null)),u(""),await k())},disabled:r,className:"mt-2 text-sm text-indigo-600 hover:text-indigo-500"},"კოდის თავიდან გაგზავნა")),(0,o.createElement)("div",{className:"flex gap-4"},(0,o.createElement)("button",{type:"button",onClick:()=>{d(!1),u(""),t({phone:"",verificationMethod:"sms",currentPassword:"",newPassword:"",confirmPassword:""})},className:"flex-1 py-2 px-4 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},"გაუქმება"),(0,o.createElement)("button",{type:"button",onClick:async()=>{if(m&&6===m.length)if(/^\d{6}$/.test(m))if(e.newPassword===e.confirmPassword){i(!0);try{let r;if(console.log("1. Starting password reset process..."),console.log("Verification code:",m),"email"===e.verificationMethod){if(console.log("2. Verifying email code..."),r=await fetch("/wp-json/bidspace/v1/verify-reset-code",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({verification_code:m})}),!r.ok){const e=await r.json();throw console.error("Email verification error:",e),new Error("Invalid verification code")}}else{if(console.log("2. Verifying SMS code..."),!window.confirmationResult)throw console.error("No confirmationResult found in window object"),new Error("No verification in progress");try{const e=await window.confirmationResult.confirm(m);console.log("3. SMS verification result:",e)}catch(e){throw console.error("SMS confirmation error details:",{code:e.code,message:e.message,stack:e.stack}),e}}console.log("4. Updating password...");const o=await fetch("/wp-json/bidspace/v1/update-password",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({current_password:e.currentPassword,new_password:e.newPassword})});if(!o.ok){const e=await o.json();throw console.error("Password update error:",e),new Error(e.message||"Failed to update password")}console.log("5. Password updated successfully!"),E("პაროლი წარმატებით შეიცვალა","success"),d(!1),u(""),t({phone:"",verificationMethod:"sms",currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){console.error("Password reset error:",{code:e.code,message:e.message,stack:e.stack});let t=e.message;"auth/invalid-verification-code"===e.code?t="არასწორი დადასტურების კოდი":"auth/code-expired"===e.code?t="კოდს ვადა გაუვიდა":"auth/argument-error"===e.code?t="არასწორი ფორმატის კოდი":e.message.includes("current_password")&&(t="მიმდინარე პაროლი არასწორია"),E(t,"error")}i(!1)}else E("პაროლები არ ემთხვევა","error");else E("კოდი უნდა შეიცავდეს მხოლოდ ციფრებს","error");else E("გთხოვთ შეიყვანოთ 6-ნიშნა კოდი","error")},disabled:r||6!==m.length,className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400",style:{backgroundColor:"#00AEEF"}},"დადასტურება"))):(0,o.createElement)("div",{className:"flex flex-col gap-4"},(0,o.createElement)("div",null,(0,o.createElement)("label",{className:"block text-sm font-medium text-gray-700"},"ვერიფიკაციის მეთოდი"),(0,o.createElement)("div",{className:"mt-2 space-y-2"},(0,o.createElement)("div",{className:"flex items-center"},(0,o.createElement)("input",{type:"radio",name:"verificationMethod",value:"sms",checked:"sms"===e.verificationMethod,onChange:N,className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),(0,o.createElement)("label",{className:"ml-2 block text-sm text-gray-700"},"SMS ვერიფიკაცია")),(0,o.createElement)("div",{className:"flex items-center"},(0,o.createElement)("input",{type:"radio",name:"verificationMethod",value:"email",checked:"email"===e.verificationMethod,onChange:N,className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),(0,o.createElement)("label",{className:"ml-2 block text-sm text-gray-700"},"Email ვერიფიკაცია")))),"sms"===e.verificationMethod&&(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700"},"ტელეფონის ნომერი"),(0,o.createElement)("div",{className:"mt-1 relative"},(0,o.createElement)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-600"},"+995"),(0,o.createElement)("input",{type:"tel",name:"phone",id:"phone",value:e.phone,onChange:N,placeholder:"555123456",className:"w-full px-16 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"}))),(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700"},"მიმდინარე პაროლი"),(0,o.createElement)("input",{type:"password",name:"currentPassword",id:"currentPassword",value:e.currentPassword,onChange:N,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})),(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700"},"ახალი პაროლი"),(0,o.createElement)("input",{type:"password",name:"newPassword",id:"newPassword",value:e.newPassword,onChange:N,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})),(0,o.createElement)("div",null,(0,o.createElement)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700"},"გაიმეორეთ ახალი პაროლი"),(0,o.createElement)("input",{type:"password",name:"confirmPassword",id:"confirmPassword",value:e.confirmPassword,onChange:N,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})),(0,o.createElement)("button",{type:"button",onClick:k,disabled:r||!e.currentPassword||!e.newPassword||!e.confirmPassword||"sms"===e.verificationMethod&&!C(e.phone),className:"w-full inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400",style:{backgroundColor:"#00AEEF"}},r?"იგზავნება...":"პაროლის შეცვლა")))}},438:(e,t,r)=>{r.d(t,{A:()=>c});var o=r(1609),n=(r(2389),r(4860)),a=r(8761),s=r(7891),l=r(4057);const i=({currentPhone:e,onPhoneChange:t})=>{const[r,i]=(0,o.useState)(""),[c,d]=(0,o.useState)(""),[m,u]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!1),[p,b]=(0,o.useState)(null),[h,y]=(0,o.useState)(60),[w,v]=(0,o.useState)(null),[x,E]=(0,o.useState)(null);(0,o.useEffect)((()=>()=>{w&&clearInterval(w)}),[w]);const N=(0,o.useCallback)((e=>{E(e)}),[]),C=e=>{const t=e.replace(/\D/g,""),r=t.startsWith("995")?t.slice(3):t;return/^5\d{8}$/.test(r)},k=(e,t)=>{b({message:e,type:t}),setTimeout((()=>b(null)),5e3)},P=async()=>{if(C(r)){u(!0);try{if(!x)return console.error("No reCAPTCHA verifier found"),void k("გთხოვთ განაახლოთ გვერდი და სცადოთ თავიდან","error");console.log("1. Starting verification process..."),console.log("Phone number:",`+995${r}`),window.confirmationResult&&(console.log("Clearing existing confirmationResult"),window.confirmationResult=null),x._initialized||(console.log("2. Rendering reCAPTCHA..."),await x.render()),console.log("3. Sending verification code...");const e=await(0,l.ik)(s.j,`+995${r}`,x);if(!e)throw new Error("Failed to send verification code");console.log("4. Code sent successfully!"),window.confirmationResult=e,f(!0),(()=>{y(300),w&&clearInterval(w);const e=setInterval((()=>{y((t=>t<=1?(clearInterval(e),f(!1),k("დრო ამოიწურა. სცადეთ თავიდან","error"),0):t-1))}),1e3);v(e)})(),k("კოდი გამოგზავნილია","success")}catch(e){console.error("Error sending code:",{code:e.code,message:e.message,stack:e.stack});let t="შეცდომა კოდის გაგზავნისას";"auth/invalid-phone-number"===e.code?t="არასწორი ტელეფონის ნომერი":"auth/too-many-requests"===e.code?t="ძალიან ბევრი მცდელობა. გთხოვთ სცადოთ მოგვიანებით":"auth/internal-error"===e.code&&(t="გთხოვთ განაახლოთ გვერდი და სცადოთ თავიდან"),k(t,"error")}u(!1)}else k("გთხოვთ შეიყვანოთ ვალიდური ქართული მობილურის ნომერი (მაგ: 555123456)","error")};return(0,o.createElement)("div",{className:"flex flex-col gap-4"},!g&&(0,o.createElement)(a.A,{onVerifierCreated:N}),p&&(0,o.createElement)(n.A,{message:p.message,type:p.type,onClose:()=>b(null)}),g?(0,o.createElement)("div",{className:"flex flex-col gap-4"},(0,o.createElement)("div",{className:"flex flex-col gap-2.5"},(0,o.createElement)("label",{htmlFor:"verification_code",className:"text-sm font-medium text-gray-700"},"დადასტურების კოდი ",h>0&&(0,o.createElement)("span",{className:"text-gray-500 ml-2"},"(",Math.floor(h/60),":",String(h%60).padStart(2,"0"),")")),(0,o.createElement)("input",{type:"text",id:"verification_code",value:c,onChange:e=>{const t=e.target.value.replace(/\D/g,"");d(t.slice(0,6))},maxLength:6,placeholder:"შეიყვანეთ 6-ნიშნა კოდი",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",pattern:"\\d*",inputMode:"numeric"}),h>0&&(0,o.createElement)("button",{type:"button",onClick:async()=>{if(!m){if(console.log("Resending verification code..."),w&&(clearInterval(w),v(null)),d(""),x)try{console.log("Clearing existing reCAPTCHA..."),x.clear(),await new Promise((e=>setTimeout(e,1e3)))}catch(e){console.error("Error clearing reCAPTCHA:",e)}await P()}},disabled:m,className:"mt-2 text-sm text-indigo-600 hover:text-indigo-500"},"კოდის თავიდან გაგზავნა")),(0,o.createElement)("div",{className:"flex gap-4"},(0,o.createElement)("button",{type:"button",onClick:()=>{f(!1),d(""),i("")},className:"flex-1 py-2 px-4 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},"გაუქმება"),(0,o.createElement)("button",{type:"button",onClick:async()=>{if(c&&6===c.length)if(/^\d{6}$/.test(c)){u(!0);try{if(console.log("1. Starting code verification..."),console.log("Verification code:",c),!window.confirmationResult)throw console.error("No confirmationResult found in window object"),new Error("No verification in progress");console.log("2. Confirming code...");try{const e=await window.confirmationResult.confirm(c);console.log("3. Verification result:",e)}catch(e){throw console.error("Confirmation error details:",{code:e.code,message:e.message,stack:e.stack}),e}console.log("4. Updating phone number in WordPress...");const e=await fetch("/wp-json/wp/v2/users/me",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({meta:{phone_number:r}})});if(!e.ok){const t=await e.json();throw console.error("WordPress API Error:",t),new Error("Failed to update phone number")}console.log("5. Phone number updated successfully!"),k("ტელეფონის ნომერი წარმატებით შეიცვალა","success"),t(r),f(!1),d(""),i("")}catch(e){console.error("Verification Error:",{code:e.code,message:e.message,stack:e.stack});let t="არასწორი კოდი";"auth/invalid-verification-code"===e.code?t="არასწორი დადასტურების კოდი":"auth/code-expired"===e.code?t="კოდს ვადა გაუვიდა":"auth/argument-error"===e.code&&(t="არასწორი ფორმატის კოდი"),k(t,"error")}u(!1)}else k("კოდი უნდა შეიცავდეს მხოლოდ ციფრებს","error");else k("გთხოვთ შეიყვანოთ 6-ნიშნა კოდი","error")},disabled:m||6!==c.length,className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400",style:{backgroundColor:"#00AEEF"}},"დადასტურება"))):(0,o.createElement)("div",{className:"flex flex-col gap-2.5"},(0,o.createElement)("label",{htmlFor:"new_phone",className:"text-sm font-medium text-gray-700"},"ახალი ტელეფონის ნომერი"),(0,o.createElement)("div",{className:"relative"},(0,o.createElement)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-600"},"+995"),(0,o.createElement)("input",{type:"tel",id:"new_phone",value:r,onChange:e=>{const t=(e=>{let t=e.replace(/\D/g,"");return t.startsWith("995")&&(t=t.slice(3)),t=t.slice(0,9),t})(e.target.value);i(t)},placeholder:"555123456",className:"w-full px-16 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})),(0,o.createElement)("button",{type:"button",onClick:P,disabled:m||!C(r),className:"mt-2 w-full inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400",style:{backgroundColor:"#00AEEF"}},m?"იგზავნება...":"დადასტურების კოდის გაგზავნა")))},c=({isOpen:e,onClose:t,currentPhone:r,onPhoneChange:n})=>e?(0,o.createElement)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},(0,o.createElement)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},(0,o.createElement)("div",{className:"flex justify-between items-center mb-4"},(0,o.createElement)("h3",{className:"text-lg font-semibold"},"ტელეფონის ნომრის შეცვლა"),(0,o.createElement)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700"},(0,o.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},(0,o.createElement)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})))),(0,o.createElement)(i,{currentPhone:r,onPhoneChange:e=>{n(e),t()}}))):null}}]);